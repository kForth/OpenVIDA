{% extends "layout.html" %} {% block content %}
<div class="container-fluid d-flex flex-nowrap overflow-none px-0">
    <div
        class="d-flex flex-column flex-shrink-0 p-3 vh-100 overflow-y-auto col-sm-4 col-md-3 col-lg-3"
    >
        <ul class="list-unstyled ps-0">
            <!-- ko foreach: { data: partsTree, as: 'el' } -->
            <li class="mb-1" role="presentation">
                <button
                    class="btn btn-toggle d-inline-flex text-start rounded border-0"
                    data-bs-toggle="collapse"
                    aria-expanded="false"
                    data-bind="text: `${el.part.title} (${el.part.number})`, attr: { 'data-bs-target': `#part-${el.part.number}-collapse` }"
                ></button>
                <div
                    class="collapse"
                    data-bind="attr: { id: `part-${el.part.number}-collapse` }"
                >
                    <ul
                        class="btn-toggle-nav list-unstyled fw-normal pb-1 small"
                    >
                        <li>
                            <b>Title:</b
                            ><span data-bind="text: el.part.title"></span>
                        </li>
                        <li>
                            <b>P/N:</b
                            ><span data-bind="text: el.part.number"></span>
                        </li>
                        <li><b>Profiles:</b></li>
                        <!-- ko foreach: { data: el.profiles, as: 'prof' } -->
                        <li data-bind="text: prof"></li>
                        <!-- /ko -->
                    </ul>
                </div>
            </li>
            <!-- /ko -->
        </ul>
    </div>
    <div
        class="d-flex flex-column w-100 vh-100 overflow-y-auto"
        id="partContent"
    ></div>
</div>
{% endblock %} {% block js%}
<script type="text/javascript">

    function imgSize() { }

    class PartsViewModel {
        constructor () {
            var self = this;

            self.selectedProfile = ko.observable(sessionStorage.getItem("selectedProfile"));
            self.selectedProfile.subscribe((v) => {
                sessionStorage.setItem("selectedProfile", v);
                self.refreshParts();
            });

            self.partsForProfile = ko.observableArray();

            self.onPartLinkClick = function (doc, e) {
                {# if (e.ctrlKey || e.which == 2 || e.button == 4)
                    window.open($(e.target).attr("href"), '_blank').focus();
                else {
                    $.ajax({
                        url: `/Vida/partHtml/${doc.chronicleId}/`,
                        method: 'GET',
                        success: resp => {
                            $("#partContent").html(resp)
                        }
                    })
                } #}
            };

            self.refreshParts = function () {
                $.ajax({
                    url: `/Vida/partsForProfile/${self.selectedProfile()}`,
                    method: "get",
                    success: resp => {
                        console.log(resp);
                        self.partsForProfile(resp);
                    }
                });
            }
            self.refreshParts();
        }
    }
    ko.applyBindings(new PartsViewModel());
    // $('a[id^="doc-"]').on("click", function (e) { });
</script>
{% endblock %}
